---
title: 'Server-to-Server Authentication'
description: 'Bypass user authentication with token-based authentication'
icon: server
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { Steps, Step } from '@site/src/components/Steps';

# Server-to-Server Authentication

Server-to-server authentication enables your backend to provide authentication tokens to the Web SDK, bypassing the need for users to log in through Glean's SSO flow. This approach is essential for scenarios where users don't have Glean accounts or where you want to provide seamless, frictionless access to search and chat functionality.

The Web SDK supports two implementation approaches for server-to-server authentication:

1. **Manual Token Management** - Your application fetches and manages auth tokens for authenticated users
2. **Guest Auth Provider** - The Web SDK automatically manages tokens for anonymous/guest users

## Overview

Unlike [Default SSO Authentication](./default-sso) where users see a login button and complete an SSO flow, server-to-server authentication (token-based) allows your backend to obtain short-lived authentication tokens on behalf of users. This eliminates the SSO login popup and enables use cases where users may not even have Glean accounts.

## When to Use Server-to-Server Authentication

Server-to-server authentication is ideal when:

- **Users Don't Have Glean Accounts:** Your audience includes external users, customers, or anonymous visitors
- **Seamless Authentication Required:** You want to provide access without any user interaction or sign-in prompts
- **Public-Facing Applications:** You're building documentation sites, marketing pages, or customer portals
- **Anonymous Access Needed:** You want to enable search functionality for guest users
- **Third-Party Cookies Are Blocked:** Browser restrictions prevent cookie-based authentication

Choose your implementation approach:
- Use **Manual Token Management** when you have authenticated users in your system and want full control over token lifecycle
- Use **Guest Auth Provider** for public-facing deployments where users don't need to sign in

## Approach 1: Manual Token Management

This approach gives you complete control over token generation and refresh. Your application manages user authentication and fetches tokens from Glean's API.

### Installation

First, install the Web SDK:

<Tabs>
<TabItem value="npm" label="NPM">

```bash
npm install @gleanwork/web-sdk
```

Import in your application:

```typescript
import GleanWebSDK from '@gleanwork/web-sdk';
```

</TabItem>
<TabItem value="script" label="Script Tag">

Add to your page's `<head>`:

```html
<script
  defer
  src="https://{GLEAN_APP_DOMAIN}/embedded-search-latest.min.js"
></script>
```

The SDK will be available globally as `GleanWebSDK`.

</TabItem>
</Tabs>

### Setup Process

<Steps>
  <Step title="Obtain API Key">
    An admin with sufficient access needs to generate a bearer key from Glean:

    1. Navigate to the [Token Management page](https://app.glean.com/admin/setup/tokenManagement?tab=auth)
    2. Generate a new API key
    3. Store this key securely on your server
    4. Optionally set an expiration date or rotate the key as needed

    :::warning
    The API key must be stored very securely and never exposed to client-side code.
    :::
  </Step>

  <Step title="Request Authentication Tokens">
    After a user authenticates with your application, your server makes a REST API call to obtain a short-lived auth token:

    ```bash
    curl -X POST "https://<deployment-backend>.glean.com/rest/api/v1/createauthtoken" \
      -H "Authorization: Bearer <api-key>" \
      -H "X-Scio-ActAs: <user-email>"
    ```

    Replace:
    - `<deployment-backend>` with your deployment's subdomain (contact Glean support if unknown)
    - `<api-key>` with the bearer key from step 1
    - `<user-email>` with the authenticated user's email address

    :::tip
    The default TTL for these tokens is 2 hours, but this is configurable. Contact your Glean administrator to adjust this setting.
    :::

    For more details on this endpoint, see the [Create Authentication Token API](/api/client-api/authentication/createauthtoken).
  </Step>

  <Step title="Token Response">
    The Glean server creates a token payload containing:
    - Issuance time
    - User email
    - Salt value

    This payload is encrypted using GCP Key Management Service (KMS) and returned in the format:

    ```
    GLEAN_AUTH_TOKEN_...
    ```
  </Step>

  <Step title="Send Token to Client">
    Your server sends the token back to the client-side JavaScript.
  </Step>

  <Step title="Use Token with Web SDK">
    Pass the token to the Glean Web SDK when rendering components:

    ```javascript
    GleanWebSDK.renderSearchBox(document.getElementById('search-container'), {
      authMethod: 'token',
      authToken: 'GLEAN_AUTH_TOKEN_...',
      backend: 'https://{your}-be.glean.com/',
      onAuthTokenRequired: async () => {
        const response = await fetch('/api/get-glean-token');
        const { token } = await response.json();
        return token;
      }
    });
    ```

    You can use this pattern with any Web SDK component: `renderSearchBox()`, `renderChat()`, `renderSearchResults()`, `attach()`, etc.
  </Step>

  <Step title="Handle Token Refresh">
    The Web SDK provides an `authorizationNeeded` event that fires when the token is approaching expiration. Your implementation must:

    1. Listen for this event
    2. Contact your server to fetch a fresh token
    3. Return the new token to the SDK

    The `onAuthTokenRequired` callback shown above handles this automatically.
  </Step>
</Steps>

### Implementation Checklist

- [ ] Generate and securely store API key from Glean
- [ ] Implement server endpoint to request tokens from Glean
- [ ] Configure token TTL if default 2 hours is insufficient
- [ ] Pass tokens to Web SDK via `authToken` option
- [ ] Implement `onAuthTokenRequired` callback for token refresh
- [ ] Test token expiration and refresh flow

## Approach 2: Guest Auth Provider

For public-facing deployments where users don't need to authenticate, the Web SDK provides a `GuestAuthProvider` that automatically handles token generation and refresh for anonymous users.

### How It Works

The Guest Auth Provider:
1. Automatically requests authentication tokens from your Glean backend
2. Caches tokens for reuse
3. Handles token refresh transparently
4. Requires minimal configuration

### Setup Process

<Steps>
  <Step title="Import the Guest Auth Provider">
    ```typescript
    import { createGuestAuthProvider } from '@gleanwork/web-sdk';
    ```
  </Step>

  <Step title="Create the Provider">
    ```typescript
    const authProvider = createGuestAuthProvider({
      backend: 'https://{your}-be.glean.com/'
    });
    ```

    The `backend` parameter should match your Glean external search deployment URL.
  </Step>

  <Step title="Use with Web SDK">
    ##### Option A: Direct Token Usage

    ```typescript
    // Get the auth token
    const token = await authProvider.getAuthToken();

    // Render a component with the token
    GleanWebSDK.renderSearchBox(document.getElementById('search-container'), {
      authMethod: 'token',
      authToken: token,
      backend: 'https://{your}-be.glean.com/',
      onAuthTokenRequired: async () => {
        return await authProvider.getAuthToken();
      }
    });
    ```

    ##### Option B: React Integration

    Here's a complete example using React context for guest authentication:

    ```tsx
    import { createContext, useContext, useEffect, useState } from 'react';
    import { createGuestAuthProvider } from '@gleanwork/web-sdk';

    interface GuestAuthContextType {
      token: string | null;
      loading: boolean;
      error: Error | null;
      refreshToken: () => Promise<void>;
    }

    const GuestAuthContext = createContext<GuestAuthContextType | null>(null);

    export function GuestAuthProvider({
      children,
      backend
    }: {
      children: React.ReactNode;
      backend: string;
    }) {
      const [token, setToken] = useState<string | null>(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState<Error | null>(null);
      const [provider, setProvider] = useState<any>(null);

      useEffect(() => {
        const initProvider = async () => {
          try {
            const authProvider = createGuestAuthProvider({ backend });
            setProvider(authProvider);
            const authToken = await authProvider.getAuthToken();
            setToken(authToken);
          } catch (err) {
            setError(err as Error);
          } finally {
            setLoading(false);
          }
        };

        initProvider();
      }, [backend]);

      const refreshToken = async () => {
        if (!provider) return;

        try {
          setLoading(true);
          const newToken = await provider.createAuthToken();
          setToken(newToken);
          setError(null);
        } catch (err) {
          setError(err as Error);
        } finally {
          setLoading(false);
        }
      };

      return (
        <GuestAuthContext.Provider value={{ token, loading, error, refreshToken }}>
          {children}
        </GuestAuthContext.Provider>
      );
    }

    export function useGuestAuth() {
      const context = useContext(GuestAuthContext);
      if (!context) {
        throw new Error('useGuestAuth must be used within GuestAuthProvider');
      }
      return context;
    }
    ```
  </Step>

  <Step title="Apply to Glean Components">
    ```tsx
    import { useEffect, useRef } from 'react';
    import GleanWebSDK from '@gleanwork/web-sdk';

    function SearchComponent() {
      const { token, loading } = useGuestAuth();
      const searchRef = useRef<HTMLDivElement>(null);

      useEffect(() => {
        if (!token || loading || !searchRef.current) return;

        GleanWebSDK.renderSearchBox(searchRef.current, {
          authMethod: 'token',
          authToken: token,
          backend: 'https://{your}-be.glean.com/',
          onAuthTokenRequired: async () => {
            const authProvider = createGuestAuthProvider({
              backend: 'https://{your}-be.glean.com/'
            });
            return await authProvider.getAuthToken();
          }
        });
      }, [token, loading]);

      if (loading) return <div>Loading...</div>;

      return <div ref={searchRef} />;
    }
    ```
  </Step>
</Steps>

### Guest Auth Provider API

The `GuestAuthProvider` class provides two key methods:

- **`getAuthToken()`**: Returns an existing cached token or creates a new one if none exists
- **`createAuthToken()`**: Always creates a fresh authentication token

Both methods return a `Promise<AuthTokenDetails>`.

### When to Use Guest Auth

Guest authentication is ideal for:
- **Public documentation sites** - Allow visitors to search without signing in
- **Marketing pages** - Provide search functionality to anonymous users
- **Demo environments** - Quick setup without user management
- **Internal tools with anonymous access** - Public-facing internal resources

### Implementation Checklist

- [ ] Ensure your Glean deployment supports external search
- [ ] Configure your backend URL
- [ ] Import and create the guest auth provider
- [ ] Integrate with your Web SDK initialization
- [ ] Test token generation and refresh
- [ ] Handle loading and error states in your UI

## Comparison: Manual vs Guest Auth

| Feature | Manual Token Management | Guest Auth Provider |
|---------|------------------------|---------------------|
| **Use Case** | Authenticated users with known identity | Anonymous/guest users |
| **Setup Complexity** | Higher - requires API key & server endpoint | Lower - client-side only |
| **Token Control** | Full control over token lifecycle | Automatic management |
| **User Experience** | Personalized to authenticated user | Generic guest access |
| **Security** | API key must be secured server-side | No sensitive credentials needed |
| **Best For** | Internal apps, user-specific content | Public docs, marketing sites |

## Related Documentation

- [Authentication Overview](./overview)
- [Default SSO Authentication](./default-sso)
- [Create Authentication Token API](/api/client-api/authentication/createauthtoken)
- [Web SDK Options Reference](https://app.glean.com/meta/browser_api/interfaces/Options.html)
- [GuestAuthProvider API](https://app.glean.com/meta/browser_api/classes/GuestAuthProvider.html)
- [GuestAuthProviderOptions](https://app.glean.com/meta/browser_api/interfaces/GuestAuthProviderOptions.html)
